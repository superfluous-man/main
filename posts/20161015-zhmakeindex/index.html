<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zhmakeindex and the Indices Creating of Chinese Books | 桃林筆記</title>


<link rel="stylesheet" href="/book.min.cd7467d3aa1d6c3a4f8fbd91a6f8bba29ae6fc39f368e3e86d58c40693849e89.css" integrity="sha256-zXRn06odbDpPj72Rpvi7oprm/DnzaOPobVjEBpOEnok=">


<script defer src="/search.min.823583a53584e6852b9f5d3a2829327ee0311bff7644ecb5f37f9d1d7752ecc5.js" integrity="sha256-gjWDpTWE5oUrn106KCkyfuAxG/92ROy183&#43;dHXdS7MU="></script>



<link rel="icon" href="/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <span id="top"></span>

</head>
<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<p style="font-family:SYHei Heavy;text-align:center" class="book-brand">
  <a href="https://mengxianjun.org/"><img src="https://i.loli.net/2019/10/13/NemCId6lUzVWR92.png" alt="" style="width:217px;height:79px;"/></a>
</p>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2fposts\2f 20161015-zhmakeindex\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/posts/"><span class="wenxuan"></span>&nbsp;<font face="SYHei Bold">文選</font></a></li>
<li><a href="/docs/movie/"><span class="tushu"></span>&nbsp;<font face="SYHei Bold">攝影與剪輯</font></a></li>
<li><a href="/docs/jcxzx/"><span class="tushu"></span>&nbsp;<font face="SYHei Bold">基礎寫作學</font></a></li>
<li><a href="/docs/wxs/"><span class="tushu"></span>&nbsp;<font face="SYHei Bold">中國文學史</font></a></li>
<li><a href="/docs/zxs/"><span class="tushu"></span>&nbsp;<font face="SYHei Bold">中國哲學史</font></a></li>
<li><a href="/docs/alinks/"><span class="lianjie"></span>&nbsp;<font face="SYHei Bold">鏈接</font></a></li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Zhmakeindex and the Indices Creating of Chinese Books</strong>
</header>

      
<header class="markdown">
<a href="https://duoyu.ren/"><img class="circular--portrait" src="https://mengxianjun.org/img/gaosongnian.jpeg" alt="Author" /></a>
    <p class="listpagetitle">
      Zhmakeindex and the Indices Creating of Chinese Books
    </p>
<p style="font-family:SYHei Medium;text-align:left"><span class="zuozhe"></span>李二狗 <a href="https://duoyu.ren/"><span class="zuozheat"></span>國立三閭大學高松年紀念館館長</a>&nbsp;&nbsp;&nbsp;&nbsp;<span class="riqi"></span>&nbsp;Saturday, October 15, 2016 10:01&nbsp;&nbsp;&nbsp;&nbsp;<span class="zishu"></span>&nbsp;2268&nbsp;&nbsp;&nbsp;&nbsp;<span class="yuedushichang"></span>&nbsp;5 min&nbsp;&nbsp;&nbsp;&nbsp;<span class="yueduliang"></span>&nbsp;<span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span></p>
</header>
<article class="markdown">

<div style="font-family:SYHei Bold;text-align:center">



  

<a  href="/posts/"   class="book-btn">
  &#9673;返回文選列表
</a>
</div>

<p>In some big documents, for example <a href="https://mengxianjun.org/2016/04/30/cedic/"><em>The Cangjie Chinese-English Dictionary</em></a>, it is necessary both for authors and readers to create one or two keywords lists in the book appendices. These lists can help to find information quite efficiently. In this article, I introduce the <a href="https://github.com/leo-liu/zhmakeindex">zhmakeindex</a> program that aims to sort Chinese index entries.</p>

<h1 id="gen-er-a-ting-latex-indices-separately">Gen­er­a­ting LaTeX Indices Separately</h1>

<p>With the LaTeX in­dex gen­er­a­tor <a href="https://www.ctan.org/pkg/makeindex?lang=en">makeindex</a>, an index can be produced. If you want to create multiple indices in a book, you should use the <a href="https://www.ctan.org/pkg/imakeidx">imakeidx</a> package.</p>

<p>In <a href="https://mengxianjun.org/2016/04/30/cedic/"><em>The Cangjie Chinese-English Dictionary</em></a>, there are six or seven indices in appendices, and the LaTeX package <a href="https://www.ctan.org/pkg/imakeidx">imakeidx</a> was used. &ldquo;The pack­age en­ables the user to pro­duce and type­set one or more in­dexes si­mul­ta­ne­ously with a doc­u­ment.&rdquo;</p>

<p>This package is invoked as usual by means of a <strong>\usepackage</strong> command in preamble.tex:</p>

<pre><code class="language-LaTeX">\usepackage[noautomatic]{imakeidx}
</code></pre>

<p>The package option <strong><em>noautomatic</em></strong> disables the automatic splitting of the raw index files and running of the system programs. And then We can use the LaTeX index processor <a href="https://www.ctan.org/pkg/xindy?lang=en">texindy</a> and <a href="https://github.com/leo-liu/zhmakeindex">zhmakeindex</a> simultaneously to make Chinese indices and Other Indices <strong>separately</strong>.</p>

<h1 id="how-to-install-zhmakeindex-in-mainland-china">How to Install Zhmakeindex in Mainland China</h1>

<p><a href="https://github.com/leo-liu/zhmakeindex">Zhmakeindex</a> is a program for making Chinese indices in a document generated with LaTeX. It is written by <a href="https://github.com/leo-liu">Leo Liu</a> in Google <a href="https://golang.org/">Go language</a>, and released with statically linked binary code. To run <a href="https://github.com/leo-liu/zhmakeindex">zhmakeindex</a>, we should first install Google <a href="https://golang.org/">Go language</a>, and then compile <a href="https://github.com/leo-liu/zhmakeindex">zhmakeindex</a> from the source code.</p>

<h2 id="installing-google-go-language">Installing Google Go Language</h2>

<p>In Ubuntu 16.04, <a href="https://github.com/golang/go/wiki/Ubuntu">golang</a> can be installed from PPA.</p>

<pre><code class="language-bash">$ sudo add-apt-repository ppa:ubuntu-lxc/lxd-stable
$ sudo apt update	
$ sudo apt install golang-go
$ go version
  go version go1.6.2 linux/amd64
$ mkdir ~/go
$ emacs ~/.zshrc
  export GOPATH=$HOME/go
  export PATH=$HOME/bin:$PATH:$GOPATH/bin
  export PATH=$PATH:/usr/local/go/bin
$ exit
</code></pre>

<h2 id="installing-golang-packages">Installing Golang Packages</h2>

<p>To compile zhmakeindex, these Go packages should be installed:</p>

<ul>
<li><a href="https://godoc.org/golang.org/x/text">golang.org/x/text</a></li>

<li><p><a href="https://github.com/yasushi-saito/rbtree">github.com/yasushi-saito/rbtree</a></p>

<pre><code class="language-bash">$ go get golang.org/x/text
$ go get github.com/yasushi-saito/rbtree
</code></pre></li>
</ul>

<p>I do love our Great Country undoubtedly. But there is a wall named <em>The Great Firewall of China</em>, if you can&rsquo;t <strong>climb over the GFW</strong>, to install these packages will make you go insane. You can build a door to reach the source pages, for exemple <a href="https://github.com/shadowsocks">shadowsocks</a> and <a href="https://github.com/search?utf8=%E2%9C%93&amp;q=goagent">goagent</a>.</p>

<p>If you can&rsquo;t climb over the Wall, <a href="http://www.ituring.com.cn/article/207412">here</a> is a way to install these packages:</p>

<pre><code class="language-bash">$ go get github.com/golang/text
$ mkdir -p ~/go/src/golang.org/x
$ cd ~/go/src/golang.org/x
$ ln -s ~/go/src/github.com/golang/text .
</code></pre>

<h2 id="installing-zhmakeindex">Installing Zhmakeindex</h2>

<pre><code class="language-bash">$ mkdir -p ~/go/src/github.com/leo-liu
$ cd ~/go/src/github.com/leo-liu
$ git clone https://github.com/leo-liu/zhmakeindex.git
$ cd zhmakeindex
$ ./install.sh
</code></pre>

<h1 id="how-to-use-zhmakeindex">How to Use Zhmakeindex</h1>

<p>Run <em>zhmakeindex</em> in your terminal and will see:</p>

<pre><code class="language-bash">$ zhmakeindex
  用法：
  zhmakeindex [-c] [-i] [-o &lt;ind&gt;] [-q] [-r] [-s &lt;sty&gt;] [-t &lt;log&gt;]
              [-enc &lt;enc&gt;] [-senc &lt;senc&gt;] [-strict] [-z &lt;sort&gt;]
              [&lt;输入文件1&gt; &lt;输入文件2&gt; ...]
  中文索引处理程序
    选项    默认值   说明
    -c      false    忽略条目首尾空格
    -enc    utf-8    读写索引文件的编码
    -i      false    从标准输入读取
    -o      无       输出文件
    -q      false    静默模式，不输出错误信息
    -r      false    禁用自动生成页码区间
    -s      无       格式文件名
    -senc   utf-8    格式文件的编码
    -strict false    严格区分不同 encapsulated 命令的页码
    -t      无       日志文件名
    -z      pinyin   中文分组排序方式，可以使用 pinyin (reading)、bihua (stroke) 或 bushou (radical)
  版本：devel-1f89f3a(2016-07-29)	作者：刘海洋&lt;leoliu.pku@gmail.com&gt;
</code></pre>

<p>Usage of zhmakeindex is similar to makeindex. Just cd your file path and run command in terminal:</p>

<pre><code class="language-bash">$ zhmakeindex youridxfile.idx %%using default .ist file
$ zhmakeindex -s youistfile.ist youridxfile.idx %%using your personal style file
$ zhmakeindex -s youistfile.ist -z bushou youridxfile.idx %%sorting index entries by chinese characters stroke order
</code></pre>

<h1 id="the-layout-of-index-entries">The Layout of Index Entries</h1>

<p>Package <a href="https://www.ctan.org/pkg/imakeidx">imakeidx</a> can produce multiple indices and defines some others. For instance, the following commands may be used in preamble.tex file. For detailed information see the <a href="https://www.ctan.org/pkg/imakeidx">imakeidx</a> package documentation.</p>

<h2 id="specific-package-commands">Specific Package Commands</h2>

<pre><code class="language-LaTeX">\usepackage[noautomatic]{imakeidx}
\makeindex[name=ec,title=英漢索引,intoc,columns=5,columnseprule=true,columnsep=5pt,options={-s ec.ist}]
\makeindex[name=th,title=類詞索引,intoc,columns=5,columnseprule=true,columnsep=5pt,options={-s th.ist}]
\makeindex[name=zb,title=字辨索引,intoc,columns=5,columnseprule=true,columnsep=5pt,options={-s zb.ist}]
\makeindex[name=gy,title=國音索引,intoc,columns=5,columnseprule=true,columnsep=5pt,options={-s gy.ist}]
\makeindex[name=yy,title=粵音索引,intoc,columns=5,columnseprule=true,columnsep=5pt,options={-s yy.ist}]
\makeindex[name=bh,title=總畫索引,intoc,columns=6,columnseprule=true,columnsep=5pt,options={-M bh.xdy}]
\makeindex[name=cj,title=倉頡索引,intoc,columns=6,columnseprule=true,columnsep=5pt,options={-M cj.xdy}]
</code></pre>

<p>And then adjust vertical space and hangindent sapce of index entries in preamble.tex.</p>

<pre><code class="language-LaTeX">\makeatletter
%%define index items layout
\def\@idxitem{\par\addvspace{7\p@ \@plus 3\p@ \@minus 3\p@}\hangindent 17\p@}
%%define index subitems layout
\def\subitem{\par\hangindent 0\p@ \hspace*{0\p@}}
%%define index subsubitems layout
\def\subsubitem{\par\hangindent 0\p@ \hspace*{0\p@}}
%%define vspace above lettergroup name
\def\indexspace{\par\addvspace{12\p@ \@plus 2\p@ \@minus 2\p@}} 
\patchcmd\theindex{\indexname}{\indexname\vspace{5pt}}{}{}
\makeatother
</code></pre>

<p>We can type below commands into our .tex file bottom:</p>

<pre><code class="language-LaTeX">......
\phantomsection
\addcontentsline{toc}{part}{辭典檢索}
\backmatter
\onecolumn
\pagestyle{mipage}
\printindex[zb] % zhmakeindex -s zb.ist -z pinyin ec.idx
\printindex[ec] % zhmakeindex -s ec.ist -z pinyin ec.idx 
\printindex[th] % zhmakeindex -s th.ist -z pinyin th.idx 
\printindex[bh] % texindy -M bh.xdy bh.idx
\printindex[cj] % texindy -M cj.xdy cj.idx 
\printindex[yy] % zhmakeindex -s yy.ist -z bihua yy.idx
\printindex[gy] % zhmakeindex -s gy.ist -z bihua gy.idx 
\end{document}
</code></pre>

<h2 id="editing-and-using-xdy-style-files">Editing and Using .xdy style files</h2>

<p>Some indices need to generate with <a href="https://www.ctan.org/pkg/xindy?lang=en">texindy</a> and in some cases we should edit personal .xdy files. Below is an example of a .xdy file. <a href="https://www.ctan.org/pkg/xindy?lang=en">Here</a> can find more detailed information about the usage of texindy.</p>

<pre><code class="language-LaTeX">(markup-index :open  &quot;\begin{theindex} ~n
 \providecommand*\lettergroupDefault[1]{}
 \providecommand*\lettergroup[1]{%
 \par{\color{black}\HGBM\centering~——{\fontsizec{1.2cm}\ABCFONTU{#1}}——}\par\vspace{-0.5em}
   \nopagebreak
  }&quot;
          :close &quot;~n~n\end{theindex}~n&quot;
          :tree)
;; The indexentries (item_&lt;..&gt; specifiers)
(markup-indexentry :open &quot;~n  \item \indexmark &quot;           :depth 0)
(markup-indexentry :open &quot;~n    \linfont\subitem &quot;     :depth 1)
(markup-indexentry :open &quot;~n      \linfont\subsubitem &quot; :depth 2)
;; Location-references
;; delim_0 &lt;string&gt;         &quot;, &quot;
;; delim_1 &lt;string&gt;         &quot;, &quot;
;; delim_2 &lt;string&gt;         &quot;, &quot;
(markup-locclass-list :open &quot;\hfill\linfont &quot; :sep &quot;, &quot;)
;; delim_n &lt;string&gt;         &quot;, &quot;
(markup-locref-list   :sep &quot;, &quot;)
;; delim_r &lt;string&gt;         &quot;-&quot;
(markup-range :sep &quot;-&quot;)
</code></pre>

<p>Then we can run texindy in terminal with this style file:</p>

<pre><code class="language-bash">texindy -M cj.xdy cj.idx
</code></pre>

<p>The output file will be like below:</p>

<p><img src="https://ooo.0o0.ooo/2016/10/15/5802233c6c202.png" alt="xdy style output" /></p>

<h2 id="editing-and-using-ist-style-files">Editing and Using .ist style files</h2>

<p>For sorting Chinese characters in .idx file, we can run command zhmakeindex in terminal and in some cases we should edit personal .ist files. Below is an example of a .ist file. <a href="http://www.latexstudio.net/archives/6363">Here</a> can find more detailed information about the usage of zhmkeindex.</p>

<pre><code class="language-LaTeX">delim_0 &quot;\\hfill &quot;
delim_1 &quot;\\hfill &quot;
delim_r &quot;-&quot;
headings_flag 1
heading_prefix &quot;\\nopagebreak\\par\n{\\abcfontu\\fontsizec{1.1cm}\\centering——{&quot; heading_suffix &quot;}——}\\vspace*{0em}\\nopagebreak\n&quot;
item_x1 &quot;} \n  \\linfont\\subitem &quot; % Provide the right brace for level_0 items when they have no page number:
item_0 &quot;\n \\ubufont\\centering\\item \\indexmark{&quot;%added this with its usual default to mark it up
</code></pre>

<p>Then run zhmakeindex in terminal with this style file:</p>

<pre><code class="language-bash">zhmakeindex -s gy.ist -z bihua gy.idx
</code></pre>

<p>The output file will be like below:</p>

<p><img src="https://ooo.0o0.ooo/2016/10/15/580225f78baf4.png" alt="ist style output" /></p>

<h1 id="another-example-on-index-page-layout">Another Example on Index Page Layout</h1>

<p>With LaTaX package <a href="https://www.ctan.org/pkg/titleps?lang=en">titleps</a> we can set \sectionmark to the index entry. Below is an example that index entries are marked to page header.</p>

<pre><code class="language-LaTeX">\newcommand{\indexmark}[1]{\sectionmark{#1}#1}
\newpagestyle{mipage}{ %%index chapter
	\setheadrule{0.7pt}
	\sethead[{\toptitlemarks\sectiontitle}---{\bottitlemarks\sectiontitle}]
                [\linfontb\thepage]
                [{\profonta Appendices—\chaptertitle}]%even head
	        {{\profonta Appendices—\chaptertitle}}
                {\linfontb\thepage}
                {{\toptitlemarks\sectiontitle}---{\bottitlemarks\sectiontitle}}%odd head
	\setfoot[][][] %even foot
	        {}{}{} %odd foot
}
</code></pre>

<p>Then add \indexmark to .ist file or .xdy file as above .ist or .xdy example. Finally the output file will be like below:</p>

<p><img src="https://ooo.0o0.ooo/2016/10/15/58022a9ca574f.jpg" alt="indexmark style output" /></p>

<div style="font-family:SYHei Bold;text-align:center">



  

<a  href="/posts/"   class="book-btn">
  &#9673;返回文選列表
</a>
</div>
<p style="font-family:SYHei Bold;text-align:right"><span class="gengxin"></span>The article was recently updated on Wednesday, October 30, 2019, 00:11:22 by 李二狗.</p>
</article>

     
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

    </div>

    
  

<aside class="book-toc level-4 fixed">
<nav id="TableOfContents">
<ul>
<li><a href="#gen-er-a-ting-latex-indices-separately">Gen­er­a­ting LaTeX Indices Separately</a></li>
<li><a href="#how-to-install-zhmakeindex-in-mainland-china">How to Install Zhmakeindex in Mainland China</a>
<ul>
<li><a href="#installing-google-go-language">Installing Google Go Language</a></li>
<li><a href="#installing-golang-packages">Installing Golang Packages</a></li>
<li><a href="#installing-zhmakeindex">Installing Zhmakeindex</a></li>
</ul></li>
<li><a href="#how-to-use-zhmakeindex">How to Use Zhmakeindex</a></li>
<li><a href="#the-layout-of-index-entries">The Layout of Index Entries</a>
<ul>
<li><a href="#specific-package-commands">Specific Package Commands</a></li>
<li><a href="#editing-and-using-xdy-style-files">Editing and Using .xdy style files</a></li>
<li><a href="#editing-and-using-ist-style-files">Editing and Using .ist style files</a></li>
</ul></li>
<li><a href="#another-example-on-index-page-layout">Another Example on Index Page Layout</a></li>
</ul>
</nav>
</aside>




  </main>

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-83708465-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<div class="post-comment">
      
             
      
      
      
<div class="post bg-white">
    <script src="https://utteranc.es/client.js"
          repo="superfluous-man/superfluous-man.github.io"
          issue-term="pathname"
          theme="github-light"
          crossorigin="anonymous"
          async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>
</div>

</div>
<a href="#top" class="backtop"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-circle-up" class="svg-inline--fa fa-chevron-circle-up fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path fill="currentColor" d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm231-113.9L103.5 277.6c-9.4 9.4-9.4 24.6 0 33.9l17 17c9.4 9.4 24.6 9.4 33.9 0L256 226.9l101.6 101.6c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L273 142.1c-9.4-9.4-24.6-9.4-34 0z">
    </path>
</svg>

</a>
</body>
</html>
